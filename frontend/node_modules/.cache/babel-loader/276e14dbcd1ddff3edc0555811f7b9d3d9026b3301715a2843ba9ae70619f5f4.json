{"ast":null,"code":"import{jwtDecode}from'jwt-decode';import api from'../api';import{ACCESS_TOKEN,REFRESH_TOKEN}from'../constants';import{Navigate}from'react-router-dom';import{useState,useEffect}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";function Authorisedroute(_ref){let{children}=_ref;const[authorised,setAuthorised]=useState(null);useEffect(()=>{auth().catch(()=>setAuthorised(false));},[]);const refreshtoken=async()=>{const refreshtoken=localStorage.getItem(REFRESH_TOKEN);try{const res=await api.post('/user/token/refresh/',{refresh:refreshtoken});if(res.status===200){const{access}=res.data;localStorage.setItem(ACCESS_TOKEN,access);setAuthorised(true);}else{setAuthorised(false);}}catch{setAuthorised(false);console.log(\"Error refreshing token\");}};const auth=async()=>{const token=localStorage.getItem(ACCESS_TOKEN);if(!token){setAuthorised(false);return;}const jwtdecode=jwtDecode(token);const expiryoftoken=jwtdecode.exp;const now=Date.now()/1000;if(expiryoftoken<now){await refreshtoken();}else{setAuthorised(true);}};if(authorised===null){return/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"});}return authorised?children:/*#__PURE__*/_jsx(Navigate,{to:\"/login\"});}export default Authorisedroute;","map":{"version":3,"names":["jwtDecode","api","ACCESS_TOKEN","REFRESH_TOKEN","Navigate","useState","useEffect","jsx","_jsx","Authorisedroute","_ref","children","authorised","setAuthorised","auth","catch","refreshtoken","localStorage","getItem","res","post","refresh","status","access","data","setItem","console","log","token","jwtdecode","expiryoftoken","exp","now","Date","to"],"sources":["/Users/rxndal/NEA2/frontend/src/components/Authorisedroute.js"],"sourcesContent":["import {jwtDecode} from 'jwt-decode';\nimport api from '../api';\nimport {ACCESS_TOKEN, REFRESH_TOKEN} from '../constants';\nimport { Navigate } from 'react-router-dom';\nimport { useState, useEffect } from 'react';\n\nfunction Authorisedroute({children}) {\n    const [authorised, setAuthorised] = useState(null);\n    useEffect(() => {\n        auth().catch(() => setAuthorised(false));\n    }, []);\n    const refreshtoken = async () => {\n        const refreshtoken = localStorage.getItem(REFRESH_TOKEN);\n        try {\n            const res = await api.post('/user/token/refresh/', {refresh: refreshtoken});\n            if (res.status === 200) {\n                const {access} = res.data;\n                localStorage.setItem(ACCESS_TOKEN, access);\n                setAuthorised(true);\n            } else {\n                setAuthorised(false);\n            }\n        } catch {\n            setAuthorised(false);\n            console.log(\"Error refreshing token\");\n        }\n    }\n    const auth = async () => {\n        const token = localStorage.getItem(ACCESS_TOKEN);\n        if (!token) {\n            setAuthorised(false);\n            return;\n        }\n        const jwtdecode = jwtDecode(token);\n        const expiryoftoken = jwtdecode.exp\n        const now = Date.now() / 1000;\n\n        if (expiryoftoken < now) {\n            await refreshtoken();\n\n        } else {\n            setAuthorised(true);\n        }\n\n    }\n    if (authorised === null) {\n        return <div>Loading...</div>\n    }\n    return authorised ? children : <Navigate to=\"/login\" />;\n}\n\nexport default Authorisedroute;"],"mappings":"AAAA,OAAQA,SAAS,KAAO,YAAY,CACpC,MAAO,CAAAC,GAAG,KAAM,QAAQ,CACxB,OAAQC,YAAY,CAAEC,aAAa,KAAO,cAAc,CACxD,OAASC,QAAQ,KAAQ,kBAAkB,CAC3C,OAASC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAAC,OAAAC,GAAA,IAAAC,IAAA,yBAE5C,QAAS,CAAAC,eAAeA,CAAAC,IAAA,CAAa,IAAZ,CAACC,QAAQ,CAAC,CAAAD,IAAA,CAC/B,KAAM,CAACE,UAAU,CAAEC,aAAa,CAAC,CAAGR,QAAQ,CAAC,IAAI,CAAC,CAClDC,SAAS,CAAC,IAAM,CACZQ,IAAI,CAAC,CAAC,CAACC,KAAK,CAAC,IAAMF,aAAa,CAAC,KAAK,CAAC,CAAC,CAC5C,CAAC,CAAE,EAAE,CAAC,CACN,KAAM,CAAAG,YAAY,CAAG,KAAAA,CAAA,GAAY,CAC7B,KAAM,CAAAA,YAAY,CAAGC,YAAY,CAACC,OAAO,CAACf,aAAa,CAAC,CACxD,GAAI,CACA,KAAM,CAAAgB,GAAG,CAAG,KAAM,CAAAlB,GAAG,CAACmB,IAAI,CAAC,sBAAsB,CAAE,CAACC,OAAO,CAAEL,YAAY,CAAC,CAAC,CAC3E,GAAIG,GAAG,CAACG,MAAM,GAAK,GAAG,CAAE,CACpB,KAAM,CAACC,MAAM,CAAC,CAAGJ,GAAG,CAACK,IAAI,CACzBP,YAAY,CAACQ,OAAO,CAACvB,YAAY,CAAEqB,MAAM,CAAC,CAC1CV,aAAa,CAAC,IAAI,CAAC,CACvB,CAAC,IAAM,CACHA,aAAa,CAAC,KAAK,CAAC,CACxB,CACJ,CAAE,KAAM,CACJA,aAAa,CAAC,KAAK,CAAC,CACpBa,OAAO,CAACC,GAAG,CAAC,wBAAwB,CAAC,CACzC,CACJ,CAAC,CACD,KAAM,CAAAb,IAAI,CAAG,KAAAA,CAAA,GAAY,CACrB,KAAM,CAAAc,KAAK,CAAGX,YAAY,CAACC,OAAO,CAAChB,YAAY,CAAC,CAChD,GAAI,CAAC0B,KAAK,CAAE,CACRf,aAAa,CAAC,KAAK,CAAC,CACpB,OACJ,CACA,KAAM,CAAAgB,SAAS,CAAG7B,SAAS,CAAC4B,KAAK,CAAC,CAClC,KAAM,CAAAE,aAAa,CAAGD,SAAS,CAACE,GAAG,CACnC,KAAM,CAAAC,GAAG,CAAGC,IAAI,CAACD,GAAG,CAAC,CAAC,CAAG,IAAI,CAE7B,GAAIF,aAAa,CAAGE,GAAG,CAAE,CACrB,KAAM,CAAAhB,YAAY,CAAC,CAAC,CAExB,CAAC,IAAM,CACHH,aAAa,CAAC,IAAI,CAAC,CACvB,CAEJ,CAAC,CACD,GAAID,UAAU,GAAK,IAAI,CAAE,CACrB,mBAAOJ,IAAA,QAAAG,QAAA,CAAK,YAAU,CAAK,CAAC,CAChC,CACA,MAAO,CAAAC,UAAU,CAAGD,QAAQ,cAAGH,IAAA,CAACJ,QAAQ,EAAC8B,EAAE,CAAC,QAAQ,CAAE,CAAC,CAC3D,CAEA,cAAe,CAAAzB,eAAe","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}